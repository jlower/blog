---
title: 2025.11–2026实习相关整理1
date: 2025-11-07 03:00:00
categories: [实习项目]
keywords: [实习项目,实习,Node.js,面经,纺纱机]
tag: []
description:
---

## 变更资产、变更审计和灰度发布

### 核心目标

核心目标：所有变更单都能够集中审计，为满足审计需要，要采集审计信息包括变更的人、事、物。审计变更是否按要求实施了灰度、回退，信息不需包括如何实现灰度控制、如何执行灰度的细节。

人：执行相关角色，包括执行者、审批者。需要执行者、审批者信息，同时附带执行者与审批者的组织信息。

事：重点看：灰度、回退。灰度、回退是变更的一个操作步骤，回退步骤不是必须出现的。灰度步骤可能包含多次不同阶段的灰度，应该具备基本的阶段信息：灰度阶段名称、阶段起止时间、阶段的整体变更进度。实际执行灰度时，可能会涉及灰度执行的明细，如对模块进行扩容涉及实际扩容的部署实例，可以不对其进行解析处理，如需要审计明细应该转为对应变更工具中进行。每个步骤应该有明确的执行结果信息。整个变更的流程可以总结为：创建-审批-执行灰度-执行回退-结单（终止）

物：

## 时间分区的理解

mysql根据 modify_time 字段是否在时间分区范围内判断，增量的按时间分区将数据写入twd表里。

```${YYYYMMDDHH} AS ds``` 根据 ```modify_time``` 字段配合 ```ds``` 分区判断增量是啥。

来源表有时间分区 ```ds```，则可以特殊指定单个分区（```PARTITION``` 子句设计用于精确指定单个分区，不能用于多个分区），代码如下：

```SQL
SELECT
  ds -- 时间分区 ${YYYYMMDDHH}
FROM
  xx_database.xx_table PARTITION (
    p_${YYYYMMDDHH}
  ) p1
WHERE
  fchangechannel = 'XXX'
```

如果要合并多个分区，从小时表变成天表，代码如下（自动分区剪枝，TDW分布式数据库的SQL翻译器，会自动根据WHERE条件中的分区过滤条件访问最小的数据集）：

```sql
SELECT
  ds -- 时间分区 ${YYYYMMDDHH}
FROM
  xx_database.xx_table
WHERE ds BETWEEN -- 从小时表变成天表
  CONCAT(DATE_FORMAT(DATE_SUB(CURRENT_DATE, 1), 'yyyyMMdd'), '00') AND 
  CONCAT(DATE_FORMAT(DATE_SUB(CURRENT_DATE, 1), 'yyyyMMdd'), '23')
```

## 去重的方法
